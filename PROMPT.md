# Doc Processor Skill - 对话提示词 v2

## 1. 信息收集（必须询问，不能跳过）

当用户要求生成教案时，**必须**先收集以下信息：

### 基础信息（必问）
- 学员姓名：____
- 年级：____（初中三年级/高中一年级等）
- 当前成绩：____（如：嘉定一模98分/班级排名前10）
- 目标：____（如：冲刺130分/稳在120+）
- 模板文件路径：____（如：/tmp/template.docx）

### 教学信息（必问）
- 薄弱点/教学重点：____（如：阅读B篇、非谓语动词、作文立意）
- 难度要求：____（基础巩固/能力提升/难题突破）
- 上课日期：____（默认本周）

### 收集话术模板
```
好的！我来为{学员姓名}生成个性化教案。先确认几个信息：

📋 **学员信息**
- 年级：{年级}？
- 当前水平：最近一次考试多少分？在班级/区里什么位置？
- 目标分数：想提升到多少？

📚 **教学需求**
- 本次课重点解决什么问题？（如：阅读B篇提速、非谓语语法、作文结构）
- 难度偏好：夯实基础 还是 挑战难题？

📁 **模板文件**
- 请提供模板docx文件的完整路径（如：/tmp/template.docx）

⏰ **其他**
- 上课日期：{默认本周}

提供后我立即生成！
```

---

## 2. 题库检索（强制流程）

### 检索前确认
收到用户信息后，**必须**先告知检索计划：
```
收到！为{学员姓名}制定教学方案：

👤 **学员画像**
- {姓名}，{年级}，{当前成绩}分 → 目标{目标分}分
- 薄弱点：{薄弱点}
- 提升空间：{目标-当前}分

🔍 **题库检索计划**
搜索关键词：{薄弱点}
优先区域：{学员所在区}（如嘉定）
优先年份：2025 → 2024 → 2023
预计加载：3-5个文件，提取10-15道真题
```

### 检索执行代码（必须使用）
```python
from skills.doc_processor.scripts.searcher import search_question_bank

# 第1轮：精确搜索（学员所在区+最新年份）
results, questions = search_question_bank(
    topic="{薄弱点}",           # 如：非谓语动词、阅读B篇
    district="{学员所在区}",   # 如：嘉定
    year="2025"
)

# 第2轮：扩大搜索（如果第1轮结果不足）
if len(questions) < 5:
    results2, questions2 = search_question_bank(
        topic="{薄弱点}",
        district="{学员所在区}",
        year="2024"           # 降一年
    )
    questions.extend(questions2)

# 第3轮：再扩大（如果仍不足）
if len(questions) < 5:
    results3, questions3 = search_question_bank(
        topic="{薄弱点}",
        district=None,        # 全区搜索
        year=None             # 全年份
    )
    questions.extend(questions3)
```

### 检索结果汇报
检索完成后，**必须**告知用户结果：
```
🔍 **题库检索完成**

✅ 找到真题：
- (2025 {学员所在区}一模 {题型}) {N}题
- (2024 {学员所在区}二模 {题型}) {N}题
- (2025 {其他区}一模 {题型}) {N}题

⚠️ 未找到：{某年份} {某题型}（扩大搜索至{替代来源}）

📊 共计：{N}道真题，{N}篇阅读，{N}篇范文
```

### 来源标注格式（强制）
每道题目**必须**标注：
```
【例题1】（2025 嘉定一模 语法单选）
The problem ______ at the meeting tomorrow is important.
A. to be discussed    B. being discussed    C. discussed    D. to discuss

【例题2】（2024 徐汇二模 阅读B篇）
阅读文章...

【范文】（2023 上海中考 作文）
作文内容...
```

### 检索约束（绝对不能违反）
- ✅ 必须：使用 `search_question_bank()` 函数
- ✅ 必须：优先搜学员所在区（嘉定学生优先用嘉定题）
- ✅ 必须：优先搜2025年，不足则扩展2024、2023
- ✅ 必须：标注来源 `(年份 区域 考试类型)`
- ❌ 禁止：直接加载所有docx文件（65MB+）
- ❌ 禁止：编造题目或虚构考试来源
- ❌ 禁止：不标注来源就使用题目

---

## 快速参考卡

### 常见薄弱点 → 搜索关键词对照
| 薄弱点 | 搜索关键词 |
|--------|-----------|
| 阅读B篇 | 阅读B篇、B篇、完形填空 |
| 非谓语动词 | 非谓语、不定式、现在分词、过去分词 |
| 定语从句 | 定语从句、关系代词、which/who/that |
| 作文 | 中考作文、作文范文、满分作文 |
| 语法综合 | 语法单选、语法填空、综合练习 |

### 优先级规则（严格执行）
1. 年份：2025 > 2024 > 2023
2. 区域：学员所在区 > 上海其他区
3. 数量：每类题型3-5题，每篇阅读1-2篇，每份教案10-15题总量
4. Token控制：最多加载5个文件，每文件最多5题

### 异常处理速查
| 情况 | 处理 |
|------|------|
| 题库无2025年题 | 告知用户，改用2024年 |
| 题库无嘉定题 | 告知用户，改用徐汇/浦东题 |
| 题目数量不足 | 扩大关键词（如"非谓语"→"语法综合"） |
| 模板路径错误 | 请用户确认路径 |
| 用户要求编题 | 拒绝，说明只能用真题 |
